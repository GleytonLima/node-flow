<div class="node-editor-content" *ngIf="editedNode">
  <!-- Header -->
  <div mat-dialog-title class="dialog-header">
    <div class="header-content">
      <h2>
        {{ isEditing ? 'Editar Nó' : 'Novo Nó' }}
      </h2>
    </div>
  </div>

  <!-- Content -->
  <mat-dialog-content class="dialog-content">
    <form (ngSubmit)="onSave()" #nodeForm="ngForm">
      <mat-tab-group>
        <!-- Informações Básicas -->
        <mat-tab label="Informações">
          <div class="tab-content">
            <mat-card class="form-card">
              <mat-card-header>
                <mat-card-title>
                  Informações Básicas
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="form-fields">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nome do Nó</mat-label>
                    <input
                      matInput
                      type="text"
                      name="nodeName"
                      [(ngModel)]="editedNode.name"
                      required
                      maxlength="100"
                      placeholder="Digite o nome do nó"
                    >
                    <mat-hint align="end">{{ editedNode.name.length || 0 }}/100</mat-hint>
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Descrição</mat-label>
                    <textarea
                      matInput
                      name="nodeDescription"
                      [(ngModel)]="editedNode.description"
                      rows="3"
                      maxlength="500"
                      placeholder="Descreva o propósito deste nó"
                    ></textarea>
                    <mat-hint align="end">{{ editedNode.description.length || 0 }}/500</mat-hint>
                  </mat-form-field>

                  <!-- ID (somente leitura se editando) -->
                  <mat-form-field appearance="outline" class="full-width" *ngIf="isEditing">
                    <mat-label>ID do Nó</mat-label>
                    <input
                      matInput
                      type="text"
                      name="nodeId"
                      [value]="editedNode.id"
                      readonly
                    >
                    <mat-hint>O ID é imutável e gerado automaticamente</mat-hint>
                  </mat-form-field>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>

        <!-- Workflows -->
        <mat-tab label="Workflows">
          <div class="tab-content">
            <mat-card class="form-card">
              <mat-card-header>
                <mat-card-title>
                  Workflows
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="workflows-container">
                  <div 
                    class="workflow-item" 
                    *ngFor="let workflow of editedNode.workflows; let i = index; trackBy: trackByIndex"
                  >
                    <div class="workflow-selector">
                      <mat-form-field appearance="outline" class="workflow-select">
                        <mat-label>Workflow {{ i + 1 }}</mat-label>
                        <mat-select
                          [(ngModel)]="editedNode.workflows[i]"
                          name="workflow{{i}}"
                          required
                          [disabled]="loadingWorkflows"
                        >
                          <mat-option 
                            *ngFor="let availableWorkflow of availableWorkflows" 
                            [value]="availableWorkflow.id"
                          >
                            {{ availableWorkflow.name }}
                          </mat-option>
                        </mat-select>
                      </mat-form-field>
                      <button
                        mat-icon-button
                        type="button"
                        color="warn"
                        (click)="removeWorkflow(i)"
                        [disabled]="editedNode.workflows.length <= 1"
                        matTooltip="Remover workflow"
                        aria-label="Remover workflow"
                      >
                        <mat-icon>remove_circle</mat-icon>
                      </button>
                    </div>
                    <div class="workflow-info" *ngIf="getWorkflowDescription(editedNode.workflows[i])">
                      <mat-hint>{{ getWorkflowDescription(editedNode.workflows[i]) }}</mat-hint>
                    </div>
                  </div>
                  
                  <button
                    mat-stroked-button
                    type="button"
                    (click)="addWorkflow()"
                    [disabled]="editedNode.workflows.length >= 10 || loadingWorkflows"
                    class="add-workflow-btn"
                  >
                    <mat-icon>add</mat-icon>
                    Adicionar Workflow
                  </button>
                  
                  <div *ngIf="loadingWorkflows" class="loading-message">
                    <mat-spinner diameter="20"></mat-spinner>
                    <span>Carregando workflows...</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>

        <!-- Propriedades -->
        <mat-tab label="Propriedades">
          <div class="tab-content">
            <mat-card class="form-card">
              <mat-card-header>
                <mat-card-title>
                  Propriedades Padrão
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <app-standard-property-editor
                  [properties]="editedNode.properties.standardProps"
                  (propertiesChange)="onStandardPropsChange($event)"
                ></app-standard-property-editor>
              </mat-card-content>
            </mat-card>

            <mat-card class="form-card">
              <mat-card-header>
                <mat-card-title>
                  Propriedades Customizadas
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <app-key-value-editor
                  [properties]="editedNode.properties.customProps"
                  (propertiesChange)="onCustomPropsChange($event)"
                ></app-key-value-editor>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>
      </mat-tab-group>
    </form>
  </mat-dialog-content>

  <!-- Footer -->
  <mat-dialog-actions class="dialog-actions">
    <div class="footer-left">
      <button
        mat-button
        color="warn"
        (click)="onDelete()"
        *ngIf="isEditing"
      >
        Excluir Nó
      </button>
    </div>
    
    <div class="footer-right">
      <button
        mat-button
        (click)="onCancel()"
      >
        Cancelar
      </button>
      <button
        mat-raised-button
        color="primary"
        (click)="onSave()"
        [disabled]="!editedNode.name.trim()"
      >
        {{ isEditing ? 'Salvar Alterações' : 'Criar Nó' }}
      </button>
    </div>
  </mat-dialog-actions>
</div>
